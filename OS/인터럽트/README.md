# 인터럽트


### 인터럽트 정의

- 인터럽트는 CPU가 프로그램을 실행하는 도중에
- '중요하거나 예기치 않은 상황'을 만나거나
- 외부 장치의 인터럽트 요청과 같은 인터럽트 요청이나 시스템 콜이 왔을 때,
- 현재 실행 중인 작업을 잠시 중단하고
- 인터럽트된 상황을 우선 처리한 후
- 중단 되었던 작업으로 복귀하여 계속 처리하는 것을 의미한다.
<br>

### 인터럽트의 종류

- 인터럽트는 요인과 특성에 따라 외부 인터럽트, 내부 인터럽트, 소프트웨어 인터럽트 이 3가지 종류로 나뉘게 됩니다.
    - `외부 인터럽트`
        - CPU 외부로부터의 인터럽트 요구 신호에 의해 발생되는 인터럽트입니다.
        - `Maskable interrupt`, `Non-maskable interrupt` 두 종류로 나뉘게 됩니다.
        - Maskable interrupt는 CPU가 인터럽트를 받아들일지 말지를 선택할 수 있는 인터럽트이고
        - Non-maskable interrupt는 정전, 하드웨어 고장과 같이 거부하거나 무시할 수 있는 인터럽트입니다.
        - 예를 들면 전원의 문제로 생기는 `전원 이상 인터럽트`, CPU의 문제로 생기는 `기계 착오 인터럽트`, 타이머 등과 같은 외부 신호로부터 생기는 `외부 신호 인터럽트`, 입출력장치간의 데이터 전송을 위한 `입출력 인터럽트` 등이 있습니다.
    - `내부 인터럽트`
        - CPU 내부의 연산 작업 중에 명령어를 처리하지 못했을 때 생기는 인터럽트입니다.
        - 이를 `Exception`이나 `Trap`이라고도 부릅니다.
        - 이 때, CPU의 제어권을 운영체제를 전달해서 이 상황을 조치합니다.
        - 예를 들면, 0으로 나누거나 OverFlow, UnderFlow 같이 프로그램이 허용하지 않는 연산에 의해 생기는 `프로그램 검사 인터럽트` 등이 있습니다.
    - `소프트웨어 인터럽트`
        - 사용자 프로세스가 운영 체제의 `커널 함수`의 `명령어`를 요청 위해 `시스템 콜` 을 호출할 때 사용하는 인터럽트입니다.
        - 컴퓨터의 하드웨어 보안 특성상 사용자 모드에서 일반 명령어로 처리할 수 없는 작업을 운영체제에 위임해서 작업을 처리하는 것을 의미합니다.
        - 예를 들면, 컴퓨터의 저장 장치에 있는 파일을 들고 올 때, 사용자 모드로는 저장 장치에 직접 접근이 제한 되기 때문에 시스템 콜을 호출해서 운영체제를 통해서 전달 받아서 처리할 수 있다.
<br>

### CPU의 인터럽트 처리 과정

1. CPU에는 `인터럽트 요청 라인`(interrupt request line)이라는 하나 이상의 선이 있으며, CPU는 하나의 명령어의 실행이 완료될 때마다 이 선을 감지합니다.
2. 이를 통해 인터럽트 요청이 감지되면 CPU는 현재 수행 중인 연산 작업을 잠시 멈추고, 인터럽트 당시의 `상태 레지스터`를 `PCB(Process Control Block)`를 저장하고 인터럽트 처리 후 실행할 명령어 주소를 `PC(Program Counter)`에 저장 합니다.
3. CPU는 전달받은 인터럽트 원인과 인터럽트 처리 번호를 읽고, `인터럽트 벡터 테이블`의 처리 번호의 주소값인 `인터럽트 서비스 루틴(인터럽트 핸들러)`으로 점프하여 필요한 처리를 진행합니다.
4. 이 때, 또 다른 우선 순위가 높은 인터럽트가 발생하면 재귀적으로 2-3번의 과정을 다시 진행한다. 
5. 필요한 인터럽트 처리가 끝나면 CPU를 인터럽트 전의 상태로 되돌려 중단된 작업을 마저 진행합니다.
<br>

### **인터럽트 벡터(Interrupt Vector)**

- 인터럽트가 발생했을 때 해야 `처리할 주소-인터럽트 번호(Key)`와 `해야 할 일-인터럽트 서비스 루틴(Value)`을 테이블로 만들어 놓은 것을 의미합니다.
- 테이블 내에서는 `발생 원인`(source)마다 처리하는 일이 다르게 설정되어 있고 인터럽트 번호를 인덱스로 하여 접근합니다.
- 인터럽트의 번호에는 `중요도`가 매핑 되어 있어서 우선순위를 정할 수 있는 장점을 가집니다.
<br>

### 인터럽트 서비스 루틴

- 인터럽트 서비스 루틴은 일반적으로 운영체제 `내부`에서 정의되어 있고, 해당 인터럽트 처리가 필요한 경우에 실행 됩니다.
<br>

### 요약

- 인터럽트는 예기치 않은 상황이 발생하거나 외부 장치의 인터럽트 요청이나 시스템 콜이 발생했을 때,
- 현재 실행 중인 작업을 잠시 중단하고 인터럽트된 상황을 우선 처리를 하는 것을 의미합니다.
- 이를 통해 중요하거나 긴급한 작업을 먼저 처리할 수 있고
- 예기치 않은 상황에서도 시스템을 안정적으로 운영할 수 있는 장점을 가집니다.
<br>
