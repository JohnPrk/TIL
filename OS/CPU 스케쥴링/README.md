# CPU 스케쥴링

<br>

### 정의

- `CPU 스케줄링`은 메모리에 적재 되어있는 다양한 프로세스를 어떻게 CPU에 할당할지 결정하는 방식입니다.
<br>

### 선점형 스케쥴링 vs 비선점형 스케쥴링

- CPU 스케쥴링은 CPU를 강제로 할당할 수 있는지, 없는지에 따라
- 선점(preemptive)형, 비선점(non-preemptive)형 스케줄링으로 나눌 수 있습니다.
- 여기에서 선점이라는 행위의 주체는 현재 실행되고 있는 프로세스가 아니라 앞으로 실행될 프로세스를 의미합니다.
    - 선점형 스케쥴링
        - 어떤 프로세스가 CPU를 할당받아 `실행 중`에 있더라도
        - 현재 실행 중인 프로세스를 `중지` 시키고 `새로운 프로세스`가 CPU를 강제로 뺏을 수 있는 것을 의미합니다.
        - 이러한 선점형 스케쥴링의 장점은 다음과 같습니다.
            - 선점형 스케쥴링의 경우 우선순위가 높은 프로세스가 먼저 실행되므로, 중요한 작업에 빠르게 처리 할 수 있습니다.
            - 또한 선점형 스케쥴링을 통해서 I/O 프로세스의 작업 중에 CPU 프로세스의 작업을 함께 처리할 수 있습니다.
            - 일반적으로 프로세스는 CPU 작업과 I/O 작업이 번갈아 가면서 진행되는 사이클로 구성이 되어 있는데,
            - 이 때, I/O 작업은 입출력 장치의 CPU인 컨트롤러를 사용하기 때문에 CPU를 사용하지 않는 특성을 가지고 있습니다.
            - 따라서 해당 장치의 컨트롤러가 작동하는 동안 프로세스가 대기 상태에 있을 때는 운영체제는  CPU를 다른 프로세스에게 할당할 수 있고
            - 이를 통해 CPU의 이용률을 높일 수 있는 특성을 가지고 있습니다.
        - 선점형 스케쥴링의 유일한 단점은 `컨텍스트 스위칭` 비용이 많다는 것입니다.
            - 프로세스가 실행 중인 상태에서 강제로 CPU를 회수하여 다른 프로세스로 전환하면,
            - 이전 프로세스의 상태를 저장하고, 새로운 프로세스를 레지스터와 ALU에 적재해야 합니다.
            - 이러한 과정에서
                - 프로세스에 필요한 데이터, 코드, 힙과 같은 메모리를 다시 적재해야하고
                - 캐시 메모리를 초기화 해야하는 등의 오버헤드가 발생하게 됩니다.
        - 선점형 스케쥴링 방식에는 `라운드 로빈` 방식 등이 있고,
        - 윈도우즈, 맥OS, 리눅스 등을 포함된 거의 모든 운영체제는 선점형 스케쥴링 알고리즘을 사용합니다.
    - 비선점형 스케쥴링
        - 어떤 프로세스가 CPU를 할당 받으면 그 프로세스가 종료되거나 입출력 요구가 발생하여 자발적으로 중지될 때까지 계속 실행되도록 보장합니다.
        - 선점형 방식에 비해 Context Switching으로 인한 Overhead가 적은 장점이 있습니다.
        - 작업이 끝날 때 까지 다른 프로세스(혹은 스레드)들은 대기해야 하므로 처리율이 떨어질 수 있다.
        - 비선점 스케쥴링에는 `FCFS`(First Come First Serve), `SJF`(Shortest Job First) 방식이 있습니다.
<br>

### 스케쥴링 알고리즘

- 스케쥴링 알고리즘을 설명하기 앞서서, 프로세스의 `처리 순서`를 포함하는 `배열`을 일반적으로 `준비 큐`라고 명명 하겠습니다.
- 비선점형 스케쥴링 알고리즘은 다음과 같습니다.
    - FCFS(`선입 선처리 스케쥴링`)
        - 선입 선처리 스케쥴링은 가장 간단한 알고리즘으로, 먼저 요청하는 프로세스 순서대로 CPU를 할당 하는 알고리즘입니다.
        - 이러한 스케쥴링은 `Queue`를 통해 쉽게 구현할 수 있습니다.
        - 장점으로는 ‘구현이 쉬운 편이다’라는 것이고,
        - 단점으로는 실행되고 있는 프로세스가 굉장히 길어진다면 평균대기 시간이 길다는 단점이 있습니다.
    - SJF(`최단 작업 우선 스케쥴링`)
        - 최단 작업 우선 스케쥴링은 CPU 작업 시간이 가장 짧은 순서대로 CPU를 할당하는 알고리즘입니다.
        - 하지만, 다음에 실행될 CPU의 작업 시간을 알 방법이 없기 때문에 구현을 할 수 없다는 특징이 있습니다.
        - 따라서, ‘이 전의 CPU 작업 시간과 비슷 할 것이다’라고 가정하고 근차시로 계산해서 프로세스를 할당합니다.
        - 최단 작업 우선 스케쥴링은 선점과 비선점의 형태를 모두 띌 수 있는데,
        - 후자의 경우 새로운 프로세스가 준비 큐에 들어오게 되면 남은 시간을 기준해서 프로세스를 재할당할 수 있고,
        - 이를 SRTF(`최소 잔여 시간 우선 스케쥴링`)이라고 부른다.
    - 우선순위 스케쥴링
        - 우선순위 스케쥴링은 각 프로세스의 `우선순위`를 설정하고 이러한 우선순위를 기준으로 CPU를 할당하는 알고리즘입니다.
        - 이러한 알고리즘은 우선순위를 낮은 프로세스가 무한히 대기하는 `무한 봉쇄`(Indefinite Blocking) 또는 `기아`(Starving)가 될 수 있는 문제점을 가지고 있습니다.
        - 이러한 해결책으로 `노화`(aging)를 사용하는데, 오랫동안 대기하는 프로세스의 우선순위를 점진적으로 증가시켜서 해결하는 방법을 의미합니다.
- 선점형 스케쥴링 알고리즘은 다음과 같습니다.
    - 라운드 로빈 스케쥴링
        - 라운드 로빈 스케쥴링은 `시간 할당량`을 기준으로 모든 프로세스를 `병행적`으로 실행하는 알고리즘입니다.
        - 세부적인 구현으로는 `정해진 시간`만큼 하나의 프로세스를 실행하면 `인터럽트`를 발생 시키고 다음 프로세스를 실행하게 됩니다.
        - 이 때, 작업이 남았다면 준비 큐의 마지막                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                으로 이동하고, 작업이 남지 않았다면 자발적으로 방출 하는 방식으로 동작을 하게 됩니다.
        - 이 때, 시간 할당량에 따라서 다양한 특성을 가지게 되는데,
        - 먼저, 시간 할당량을 프로세스의 시간보다 무조건 크게 설정 한다면 FCFS 스케쥴링과 동일한 비선점형 알고리즘으로 동작하게 됩니다.
        - 또한, 시간 할당량을 너무 작게 설정 한다면 프로세스 간의 교환으로 발생하는 컨텍스트 스위칭 비용이 너무 많이 발생한다는 특징을 가지고 있습니다.
    - 다단계 큐 스케쥴링
        - 다단계 큐 스케쥴링은 우선순위 스케쥴링과 라운드 로빈 스케쥴링을 결합한 알고리즘입니다.
        - 우선순위 스케쥴링의 경우 우선순위가 가장 높은 프로세스를 결정하기 위해 최악의 경우 시간 복잡도는 O(n)가 되는데,
        - 이러한 문제를 해결하기 위해는 오히려 우선순위마다 별도의 준비 큐를 가지는 아이디어입니다.
        - 이 때, 우선순위가 가장 높은 큐에 여러 개의 프로세스가 있을 경우에는 라운드 로빈 방식으로 동작하게 됩니다.
    - 다단계 피드백 큐 스케쥴링
        - 다단계 피드백 큐 스케쥴링은 프로세스들이 큐들 사이를 이동하는 것을 허용하는 알고리즘입니다.
        - 일반적으로 하나의 프로세스가 준비 큐에 영구적으로 할당이 되는데,
        - 다단계 피드백 큐 스케쥴링에서는 프로세스의 성격에 따라서 움직일 수 있는 특성을 가지고 있습니다.
        - 이러한 스케쥴링의 기본 아이디어는
            - CPU 작업 시간이 짧은 프로세스는 우선순위를 높이고
            - CPU 작업 시간이 많으면 우선순위를 낮추는 방식을 채택하고 있다.
        - 간단하게 3개의 큐가 존재한다고 가정하고 예를 들면,
            - 첫 번째 큐에 존재하는 모든 프로세스를 최고 짧은 시간 할당량의 라운드 로빈 방식으로 실행합니다.
            - 그 시간동안 프로세스가 끝이나지 않으면 두 번째 큐로 이동 시킵니다.
            - 첫 번째 큐에 프로세스가 존재하지 않을 때 첫 번째 큐와 동일하게 중간 시간의 할당량의 라운드 로빈 방식으로 프로세스를 실행합니다.
            - 그 시간동안 프로세스가 끝이나지 않으면 세 번째 큐로 이동 시킵니다.
            - 세 번째 큐도 마찬가지로 첫 번째와 두 번째 큐에 프로세스가 존재하지 않는다면 위와 동일하게 프로세스를 실행합니다.
            - 이러한 과정 중간에 새로운 프로세스가 들어올 경우에는 무조건 첫 번째 큐에 들어가게 됩니다.
<br>
 
