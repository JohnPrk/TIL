# MySQL 아키텍처(1) - MySQL 서버 및 엔진


<br>

<img width="700" alt="Untitled" src="https://user-images.githubusercontent.com/88137420/228197906-aac2f086-f904-45c1-b996-7958da1d60d9.png">

<br>

### MySQL 서버

- MySQL 서버는 사람의 머리 역할을 담당하는 `MySQL 엔진`과 손발 역할을 담당하는 `스토리지 엔진`으로 이루어져 있습니다.
- 그리고 스토리지 엔진 같은 경우에는 핸들러 API를 만족하면 누구든지 스토리지 엔진을 구현해서 MySQL 서버에 추가해서 사용할 수 있는 특성을 가지고 있습니다.

<br>

### 핸들러 API

- MySQL 엔진의 쿼리 실행기에서 데이터를 쓰거나 읽어야 할 때는 각 스토리지 엔진에 쓰기 또는 읽기를 요청하는데, 이러한 요청을 처리하는 API를 `핸들러 API`라고 합니다.
- InnoDB 스토리지 엔진 또한 핸들러 API를 이용해서 MySQL 엔진과 데이터를 주고 받습니다.

<br>

### MySQL 엔진

- MySQL 엔진은 클라이언트로부터의 접속 및 쿼리 요청을 처리하는 `커넥션 핸들러`와 쿼리 실행에 관한 `쿼리 파서` 및 `전처리기`,  `옵티마이저`, `쿼리 실행 엔진` 및 `쿼리 캐시`로 구성되어 있습니다.
- 커넥션 핸들러
    - `커넥션 핸들러`(Connection Handler)는 클라이언트의 응용 프로그램과 데이터베이스의 서버 간의 연결 관리하는 컴포넌트입니다.
    - 사용자로부터 요청을 받으면 커넥션 핸들러는 데이터베이스의 커넥션을 하나씩 할당해주는 역할을 합니다.
    - 이러한 커넥션 핸들러는 높은 수준의 성능과 확장성을 제공하면서 동시에 많은 수의 동시 연결을 처리하도록 설계되었습니다.
- 쿼리 파서
    - `쿼리 파서`(Query Parser)는 사용자의 요청으로 들어온 쿼리 문장을 `토큰`으로 분리해 트리 형태의 구조로 만들어내는 작업을 의미합니다.
    - 이 때, 토큰은 MySQL이 인식할 수 있는 최소 단위의 어휘나 기호를 의미합니다.
    - 쿼리 문장의 기본적인 문법 오류는 이 과정에서 발견되고 사용자에게 오류 메시지를 전달합니다.
- 전처리기
    - `전처리기`(Preprocessor)는 파서 과정에서 만들어진 토큰 트리가 구조적인 문제가 있는지 확인합니다.
    - 각 토큰을 테이블 이름이나 칼럼 이름등과 매핑해서 객체의 존재 여부 및 접근 권한을 확인하는 과정을 수행합니다.
    - 실제로 존재하지 않거나 권한상 문제가 있으면 이 과정에서 발견되어집니다.
- 옵티마이저
    - `옵티마이저`(Optimizer)는 사용자의 요청으로 들어온 쿼리 문장을 분석해서 가장 빠르고 효율적인 처리 순서를 정하는 역할을 담당합니다.
    - 데이터베이스 성능 최적화는 대부분은 옵티마이저에서 이루어집니다.
- 쿼리 실행 엔진
    - 쿼리 `실행 엔진`은 옵티마이저에 의해 최적화된 쿼리를 각 순서에 맞게 핸들러 API를 통해 스토리지 엔진에게 요청을 보내는 작업을 수행합니다.
- 쿼리 캐시
    - `쿼리 캐시`(Query Cache)는 SQL 실행 결과를 메모리에 캐시하고, 동일 SQL 쿼리가 실행되면 테이블을 읽지 않고 즉시 결과를 반환하기 때문에 매우 빠른 성능을 보였습니다.
    - 하지만, 쿼리 캐시는 테이블의 데이터가 변경되면 캐시에 저장된 결과 중에 테이블과 관련된 메모리는 전부 삭제해야만 했는데, 이는 성능 저하의 이유가 되었습니다.
    - 결국, MySQL 8.0으로 마이그레이션 되면서 쿼리 캐시 기능은 삭제되었습니다.

<br>

*<참고 자료>*

- Real MySQL 8.0 개발자와 DBA를 위한 MySQL 실전 가이드 - Chapter 4 아키텍처
