# Transaction

<br>


### 트랜잭션이란?

- 트랜잭션이란, 데이터베이스의 `상태`를 변화시키기 위해서 수행하는 `작업`의 단위를 뜻합니다.
- 쉽게 이야기하자면, `SQL 질의어`를 통해 DB 상의 정보를 변경하는 것을 의미합니다.
- 이 때, 일반적으로 질의어를 보통 쿼리라고 하는데, 이 쿼리는 1개일 수도 다수의 쿼리가 될 수 있습니다.
- 예를 들어, 은행의 이체와 같은 서비스의 경우, 하나의 작업이라 할지라도 송신자에게는 출금의 작업이 수신자에게는 입금의 작업이 `순차적`으로 두 번에 걸쳐서 발생한다는 것을 알 수 있습니다.
- 따라서 정리 하자면, 트랜잭션은 데이터베이스에서 `한 번에 처리되어야 하는 여러 작업`을 `하나의 작업` 단위로 묶어서 처리하는 것을 의미합니다.
<br>

### 트랜잭션의 ACID 속성

- 트랜잭션은 ACID라는 4가지 속성을 가지고 있습니다.
    - 먼저, 트랜잭션은 `Atomicity` - `원자성`의 속성을 가지고 있습니다.
        - 원자성이란 트랜잭션 내의 모든 작업이 완료되거나 아니면 전혀 수행되지 않아야 한다는 것을 의미합니다.
        - 다시 말해서, 작업 중간에 문제가 생겨 실패가 있게 되면 이전에 작업이 성공한 성공 했다 할지라도 전부 트랜잭션 이전 상태로 되돌리는 것(롤백)을 의미합니다.
    - 두 번째로, 트랜잭션은 `Consistency` - `일관성`의 속성을 가지고 있습니다.
        - 일관성이란 트랜잭션 내에서 데이터 무결성을 가져야 한다는 것을 의미합니다.
        - 예를 들어, 송금의 경우 송신자의 잔액이 ‘-’가 되지 않아야한다는 데이터베이스의 규칙이 있다면, 데이터베이스는 커밋하기 이 전에 규칙을 확인하고 규칙이 위배 되었다면 전부 트랜잭션 이전의 상태로 되돌리는 것을 의미합니다.
    - 세 번째로, 트랜잭션은 `Isolation` - `고립성`의 속성을 가지고 있습니다.
        - 고립성이란 여러 트랜잭션이 동시에 실행될 때라도 각각의 트랜잭션이 혼자 실행하는 것과 같은 결과를 유지해야한다는 것을 의미합니다.
        - 즉 쉽게 설명하자면, 데이터베이스는 퍼포먼스를 위해서 CPU처럼 하나의 작업이 완료 되기 전에 또 다른 작업을 순차적으로 실행할 수 있는데,
        - 이 때 트랜잭션의 처리 순서에 따라서 결과값이 달라질 수 있는 문제가 생기게 되는 특성을 가지고 있습니다.
        - 이러한 문제를 해결하기 위해서 데이터베이스는 다양한 Isolation level을 두고 있는데, 이러한 고립 수준(격리 수준)은 데이터베이스의 퍼포먼스와 트레이드 오프 관계에 있는 특징을 가지고 있습니다.
        - 따라서, 개발자는 상황에 따라서 이러한 격리의 수준을 조정할 수 있어야하는 특성을 가지고 있습니다.
    - 마지막으로, 트랜잭션은 `Durability` - `지속성`의 속성을 가지고 있습니다.
        - 지속성이란 트랜잭션이 성공적으로 완료 되었을 경우, 그 결과는 영구적으로 데이터베이스에 반영된다는 것을 의미합니다.
        - 즉, 커밋 이후에 데이터베이스나 컴퓨터의 이상으로 문제가 생기더라도 이미 커밋된 쿼리는 비휘발성 메모리에 저장된다는 것을 의미합니다.
- 이러한 4가지 속성을 통해 데이터베이스의 `일관성`과 `무결성`을 보장하며, 여러 사용자가 동시에 데이터에 접근하더라도 데이터의 `정합성`을 유지할 수 있는 특징을 가지고 있습니다.
<br>

### 자바에서의 트랜잭션

  <img width="700" alt="Untitled" src="https://user-images.githubusercontent.com/88137420/226912523-a515adee-2104-4ceb-825b-b8a7d0cbbd82.png">


- MySQl로 가정하고 자바에서 트랜잭션을 처리하기 위해서는
    - 실패의 가능성에 대한 처리를 위해서 try/catch/finally을 사용합니다.
    - 먼저, JDBC로 데이터베이스 연결하고
    - 데이터베이스의 오토 커밋을 해제한 뒤에
    - 비즈니스 코드를 작성하고
    - 커밋을 하게 되는데,
    - 이 때, 문제가 발생하면 catch 쪽으로 넘어가서
    - 데이터베이스 연결 이전의 상태로 롤백하게 됩니다.
    - 마지막으로 finally를 통해서 데이터베이스의 오토 커밋을 설정을 되돌려주고
    - 데이터 베이스의 연결을 끊게 되는 작업을 하게 됩니다.
    - 이러한 트랜잭션이 발생될 때마다 try-catch-finally를 사용하는 것은 귀찮은 일이기 때문에
    - 마치 AOP를 적용한 것처럼 자바의 @Transactional 어노테이션으로 사용할 수 있습니다.

<br>
